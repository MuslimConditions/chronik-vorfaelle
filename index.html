<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Flüchtlingsfeindliche Vorfälle in Deutschland 2015</title>
    <meta name="description" content="Die gemeinsame Chronik der Amadeu Antonio Stiftung und PRO ASYL dokumentiert Übergriffe und Demonstrationen gegen Flüchtlinge und ihre Unterkünfte." />
    <link rel="image_src" href="https://ax3l.github.io/chronik-vorfaelle/img/preview_600x191.png" />

    <!-- Schema.org markup for Google+ (needs additional attributes in <html>)
        <meta itemprop="name" content="Flüchtlingsfeindliche Vorfälle in Deutschland 2015" />
        <meta itemprop="description" content="Die gemeinsame Chronik der Amadeu Antonio Stiftung und PRO ASYL dokumentiert Übergriffe und Demonstrationen gegen Flüchtlinge und ihre Unterkünfte." />
        <meta itemprop="image" content="https://ax3l.github.io/chronik-vorfaelle/img/preview_600x191.png" />
    -->

    <!-- Twitter Card data, https://dev.twitter.com/cards/overview -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@AmadeuAntonio" />
    <meta name="twitter:site" content="@ProAsyl" />
    <meta name="twitter:title" content="Flüchtlingsfeindliche Vorfälle in Deutschland 2015" />
    <meta name="twitter:description" content="Die gemeinsame Chronik der Amadeu Antonio Stiftung und PRO ASYL dokumentiert Übergriffe und Demonstrationen gegen Flüchtlinge und ihre Unterkünfte." />
    <meta name="twitter:creator" content="@AmadeuAntonio" />
    <meta name="twitter:creator" content="@ProAsyl" />
    <!-- Twitter Summary card images must be at least 120x120px -->
    <meta name="twitter:image" content="https://ax3l.github.io/chronik-vorfaelle/img/preview_600x191.png" />
    <!-- Twitter summary card with large image must be at least 280x150px -->
    <meta name="twitter:image:src" content="https://ax3l.github.io/chronik-vorfaelle/img/preview_600x191.png" />

    <!-- Open Graph data (most standardized, most important), http://ogp.me/ -->
    <meta property="og:title" content="Flüchtlingsfeindliche Vorfälle in Deutschland 2015" />
    <meta property="og:type" content="article" />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:url" content="https://ax3l.github.io/chronik-vorfaelle/" />
    <!-- <meta property="og:url" content="https://www.mut-gegen-rechte-gewalt.de/chronik-karte" /> -->
    <!-- at least 200x200px, up to 1200x630px recommended -->
    <meta property="og:image" content="https://ax3l.github.io/chronik-vorfaelle/img/preview_600x191.png" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="600" />
    <meta property="og:image:height" content="191" />
    <meta property="og:description" content="Die gemeinsame Chronik der Amadeu Antonio Stiftung und PRO ASYL dokumentiert Übergriffe und Demonstrationen gegen Flüchtlinge und ihre Unterkünfte." />
    <meta property="og:site_name" content="Mut gegen rechte Gewalt" />
    <!-- <meta property="article:author" content="Amadeu Antonio Stiftung und PRO ASYL" /> needs to be a "profile" type -->
    <meta property="article:section" content="Gesellschaft" />
    <meta property="article:tag" content="Flucht" />
    <meta property="article:tag" content="Refugees" />
    <meta property="article:tag" content="Asyl" />
    <meta property="article:tag" content="kaltland" />
    <!-- <meta property="article:published_time" content="2013-09-17T05:59:00+01:00" />
         <meta property="article:modified_time" content="2013-09-16T19:08:47+01:00" />
    -->
    <!-- <meta property="og:video" content="http://example.com/bond/trailer.swf" />
         <meta property="og:video:type" content="application/x-shockwave-flash" />
         <meta property="og:video:width" content="400" />
         <meta property="og:video:height" content="300" />
    -->

    <!-- style sheets -->
    <link rel="stylesheet" href="bower_components/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="PruneCluster/dist/LeafletStyleSheet.css" />
    <style type="text/css">
      html, body, #map {
        height: 100%; width: 100%;
        margin: 0;
        padding: 0;
      }

      .prunecluster-small {
        background-color: rgba(225, 200, 35, 0.5);
      }
      .prunecluster-small div {
        background-color: rgba(225, 200, 35, 0.6);
      }
      .prunecluster-medium {
        background-color: rgba(220, 90, 23, 0.5);
      }
      .prunecluster-medium div {
        background-color: rgba(220, 90, 23, 0.5);
      }
      .prunecluster-large {
        background-color: rgba(140, 12, 23, 0.5);
      }
      .prunecluster-large div {
        background-color: rgba(140, 12, 23, 0.6);
      }
      .legend {
        line-height: 60px;
        color: #555;
        padding: 6px 8px;
        background: white;
        background: rgba(255,255,255,0.8);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 8px;
      }
      .legend img {
        width: 50px;
        height: 50px;
        float: left;
        margin-right: 10px;
      }
    </style>

    <script src="bower_components/leaflet/dist/leaflet.js"></script>
    <script src="PruneCluster/dist/PruneCluster.js"></script>
  </head>

  <body>
    <div id="map"></div>

    <script type="text/javascript"> 
      // init map and zoom to Germany
      var map = L.map('map').setView([51.5, 11.0], 6);

      // limit panning to Germany
      map.setMaxBounds([
        [60.0, 0.0],
        [40.0, 22.0]
      ]);

      // choose tile backend (OSM)
      L.tileLayer('http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', //'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
      {
        minZoom: 6,
        maxZoom: 14,
        attribution: 'Datenquelle: <a href="https://www.mut-gegen-rechte-gewalt.de/service/chronik-vorfaelle">Mut gegen rechte Gewalt</a> | &copy; <a href="https://github.com/ax3l/chronik-vorfaelle/tree/gh-pages/img">Icons</a> | &copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
      }).addTo(map);

      // legend
      var legend = L.control({position: 'bottomright'});

      legend.onAdd = function (map) {
        var div = L.DomUtil.create('div', 'legend');
        div.innerHTML += '<img src="img/house.svg" />' +
                         'Brandanschlag<br />';
        div.innerHTML += '<img src="img/attack.svg" />' +
                         'Tätlicher Übergriff/Körperverletzung<br />';
        div.innerHTML += '<img src="img/clash.svg" />' +
                         'Sonstige Angriffe auf Unterkünfte<br />';
        div.innerHTML += '<img src="img/demo.svg" />' +
                         'Kundgebung/Demo<br />';
        return div;
      };

      legend.addTo(map);

      // add a marker
      // L.marker([51.5, -0.09]).addTo(map)
      //  .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
      //  .openPopup();

      // marker helper functions
      function createIcon(data, category) {
        // See http://leafletjs.com/reference.html#icon
        if( category == "Brandanschlag" )
          return L.icon({
            iconUrl: 'img/house.svg',
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -30]
            });

        if( category.indexOf("verletzung") > -1 )
          return L.icon({
            iconUrl: 'img/attack.svg',
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -30]
            });

        if( category.indexOf("Sonstige Angriffe auf Unterk") > -1 )
          //return L.icon({
          //  iconUrl: 'img/fire.svg',
          //  iconSize: [40, 40],
          //  iconAnchor: [20, 40],
          //  popupAnchor: [0, -25]
          //  });
          return L.icon({
            iconUrl: 'img/clash.svg',
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -30]
            });

        if( category == "Kundgebung/Demo" )
          return L.icon({
            iconUrl: 'img/demo.svg',
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -30]
            });

        else
          return L.icon({
            iconUrl: 'img/clash.svg',
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -30]
            });
      }

      var pruneCluster = new PruneClusterForLeaflet(100, 10);
      var markers = [];

      // load JSON
      var xmlhttp = new XMLHttpRequest();
      var url = "https://raw.githubusercontent.com/ax3l/chronik-vorfaelle/data/vorfaelle.geojson";

    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        var geo_json = JSON.parse(xmlhttp.responseText);
        var vorfaelle = geo_json['features'];

        for(var i=0, l=vorfaelle.length; i<l; ++i) {
          v = vorfaelle[i];
          coord = v['geometry']['coordinates']
          var marker = new PruneCluster.Marker( coord[1], coord[0] );
          // marker.data.name = 'Roger';
          // marker.data.ID = '76ez';
          // number or a string; minimize the performance cost: recommended 0-7
          marker.category = v.properties.title;
          marker.data.icon = createIcon;
          // marker.weight = 4;
          // marker.filtered = true|false;
          marker.data.popup = '<b><i>' + v.properties.city + '</i>, ' +
                              v.properties.date + ':</b> ' + v.properties.description +
                              '<br /><b>Quelle:</b> ' + v.properties.source;

          markers.push(marker);
          pruneCluster.RegisterMarker(marker);

          // break;
        }

        // pruneCluster.Cluster.Size = 87;
        // pruneCluster.ProcessView();
        map.addLayer(pruneCluster);
        pruneCluster.RedrawIcons();
      }
    }

    xmlhttp.open("GET", url, true);
    xmlhttp.send();
    </script>
  </body>
</html>
